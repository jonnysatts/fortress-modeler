<!DOCTYPE html>
<html>
<head>
    <title>Debug Model Creation</title>
</head>
<body>
    <h1>Debug Model Creation</h1>
    <button id="testBtn">Test Model Creation</button>
    <div id="output"></div>
    
    <script type="module">
        // Simple test to debug model creation
        async function testModelCreation() {
            const output = document.getElementById('output');
            output.innerHTML = 'Testing...';
            
            try {
                // Test basic IndexedDB operations
                const request = indexedDB.open('FortressDB', 5);
                
                request.onsuccess = async function(e) {
                    const db = e.target.result;
                    const transaction = db.transaction(['projects', 'financialModels'], 'readwrite');
                    
                    // First create a test project
                    const projectStore = transaction.objectStore('projects');
                    const testProject = {
                        name: 'Test Project',
                        productType: 'SaaS',
                        createdAt: new Date(),
                        updatedAt: new Date(),
                        uuid: crypto.randomUUID()
                    };
                    
                    const projectResult = await new Promise((resolve, reject) => {
                        const req = projectStore.add(testProject);
                        req.onsuccess = () => resolve(req.result);
                        req.onerror = () => reject(req.error);
                    });
                    
                    output.innerHTML += `<br>Project created with ID: ${projectResult}`;
                    
                    // Then create a test model
                    const modelStore = transaction.objectStore('financialModels');
                    const testModel = {
                        projectId: projectResult,
                        name: 'Test Model',
                        assumptions: {
                            revenue: [{name: 'Test Revenue', value: 100, type: 'recurring', frequency: 'monthly'}],
                            costs: [{name: 'Test Cost', value: 50, type: 'fixed', category: 'operations'}],
                            growthModel: {type: 'linear', rate: 0.1}
                        },
                        createdAt: new Date(),
                        updatedAt: new Date(),
                        uuid: crypto.randomUUID()
                    };
                    
                    const modelResult = await new Promise((resolve, reject) => {
                        const req = modelStore.add(testModel);
                        req.onsuccess = () => resolve(req.result);
                        req.onerror = () => reject(req.error);
                    });
                    
                    output.innerHTML += `<br>Model created with ID: ${modelResult}`;
                };
                
                request.onerror = function(e) {
                    output.innerHTML = 'Error opening database: ' + e.target.error;
                };
                
            } catch (error) {
                output.innerHTML = 'Error: ' + error.message;
                console.error('Full error:', error);
            }
        }
        
        document.getElementById('testBtn').addEventListener('click', testModelCreation);
    </script>
</body>
</html>