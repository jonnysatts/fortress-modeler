<!DOCTYPE html>
<html>
<head>
    <title>OAuth Test</title>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
</head>
<body>
    <h1>Supabase OAuth Test</h1>
    <button onclick="testGoogleAuth()">Test Google OAuth</button>
    <button onclick="testConnection()">Test Supabase Connection</button>
    
    <div id="output"></div>

    <script>
        // Use the same environment variables
        const supabaseUrl = 'https://vplafscpcsxdxbyoxfhq.supabase.co';
        const supabaseAnonKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZwbGFmc2NwY3N4ZHhieW94ZmhxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTEyNjY5MDQsImV4cCI6MjA2Njg0MjkwNH0.y3RL3Aq-2q_OW0AKoawV0-Q0JFpleTs5xHt52lVAsnQ';
        
        const supabase = window.supabase.createClient(supabaseUrl, supabaseAnonKey);
        
        function log(message) {
            document.getElementById('output').innerHTML += '<p>' + message + '</p>';
            console.log(message);
        }
        
        async function testConnection() {
            try {
                log('Testing Supabase connection...');
                const { data, error } = await supabase.from('projects').select('count').limit(1);
                if (error) {
                    log('Connection test failed: ' + error.message);
                } else {
                    log('Connection test successful!');
                }
            } catch (err) {
                log('Connection error: ' + err.message);
            }
        }
        
        async function testGoogleAuth() {
            try {
                log('Testing Google OAuth...');
                
                const { data, error } = await supabase.auth.signInWithOAuth({
                    provider: 'google',
                    options: {
                        redirectTo: window.location.origin
                    }
                });
                
                if (error) {
                    log('OAuth error: ' + error.message);
                    log('Error code: ' + error.error_code);
                    log('Error details: ' + JSON.stringify(error));
                } else {
                    log('OAuth initiated successfully!');
                    log('Redirect URL: ' + data.url);
                }
            } catch (err) {
                log('Exception: ' + err.message);
            }
        }
        
        // Test different provider names
        async function testOtherProviders() {
            const providers = ['google', 'github', 'discord', 'facebook'];
            
            for (const provider of providers) {
                try {
                    log(`Testing provider: ${provider}`);
                    const { data, error } = await supabase.auth.signInWithOAuth({
                        provider: provider,
                        options: { redirectTo: window.location.origin }
                    });
                    
                    if (error) {
                        log(`${provider}: ${error.message}`);
                    } else {
                        log(`${provider}: SUCCESS`);
                    }
                } catch (err) {
                    log(`${provider}: Exception - ${err.message}`);
                }
                
                // Small delay between tests
                await new Promise(resolve => setTimeout(resolve, 100));
            }
        }
        
        // Run provider test on load
        setTimeout(testOtherProviders, 1000);
    </script>
</body>
</html>